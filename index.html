<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Async-init by heartnetkung</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Async-init</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/heartnetkung/async-init" class="btn">View on GitHub</a>
      <a href="https://github.com/heartnetkung/async-init/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/heartnetkung/async-init/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h2>
<a id="le-problem" class="anchor" href="#le-problem" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Le Problem</h2>

<p>Asynchronous init can be a pain to work with. For example, look at the following code.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">db</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>some-database-library<span class="pl-pds">'</span></span>);
<span class="pl-smi">db</span>.<span class="pl-en">init</span>(<span class="pl-k">function</span> <span class="pl-en">callback</span>(){
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>init done!<span class="pl-pds">'</span></span>);
});
<span class="pl-c1">exports</span>.<span class="pl-en">getUser</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">callback</span>) {
    <span class="pl-smi">db</span>.<span class="pl-en">query</span>(<span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span>, callback);
};</pre></div>

<p>The flaw of this code is that any getUser function call before the init is finished will fail. Notice that your database init is asynchronous but your exports.getUser must be declared synchronously. The correct implementation of this program is not clean as it requires <em>Promise</em> and callback, or worse change your function design entirely. This library tries to offer a nice-ish solution.</p>

<h2>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example</h2>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">init</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>async-init<span class="pl-pds">'</span></span>).<span class="pl-en">create</span>();
<span class="pl-k">const</span> <span class="pl-c1">db</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>some-database-library<span class="pl-pds">'</span></span>);
<span class="pl-smi">db</span>.<span class="pl-en">init</span>(<span class="pl-smi">init</span>.<span class="pl-smi">done</span>);

<span class="pl-k">const</span> <span class="pl-c1">db2</span> <span class="pl-k">=</span> <span class="pl-smi">init</span>.<span class="pl-en">wrapAll</span>(db);
<span class="pl-c1">exports</span>.<span class="pl-en">getUser</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">callback</span>) {
    <span class="pl-c">//here db.query will be called after db.init is completed.</span>
    <span class="pl-smi">db2</span>.<span class="pl-en">query</span>(<span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span> ,callback);
};</pre></div>

<h2>
<a id="api" class="anchor" href="#api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>API</h2>

<h4>
<a id="initdone" class="anchor" href="#initdone" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>init.done</h4>

<p>Call this function when the init is done.</p>

<h4>
<a id="initwrapallobject" class="anchor" href="#initwrapallobject" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>init.wrapAll(object)</h4>

<p>Create a new wrapper object delegating all functions call until after the init is done. Non-function properties are copied over.</p>

<h4>
<a id="initwrapobject-functionnamestring" class="anchor" href="#initwrapobject-functionnamestring" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>init.wrap(object, functionName:string)</h4>

<p>Return a single wrapping function.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/heartnetkung/async-init">Async-init</a> is maintained by <a href="https://github.com/heartnetkung">heartnetkung</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
